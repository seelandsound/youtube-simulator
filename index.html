<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ä¼åŠƒæ¨¡æ“¬å™¨</title>
    
    <!-- å¤–éƒ¨è³‡æº: å…ˆè¼‰å…¥æ‰€æœ‰éœ€è¦çš„å¤–éƒ¨å‡½å¼åº« -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- TailwindCSS é…ç½® -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'yt-red': '#FF0000',
                        'yt-black': '#0F0F0F',
                        'yt-white': '#FFFFFF',
                        'yt-light-black': '#272727',
                        'yt-gray': '#606060',
                        'yt-dark-gray': '#AAAAAA',
                        'yt-hover-bg': 'rgba(255, 255, 255, 0.1)',
                        'yt-light-hover-bg': 'rgba(0, 0, 0, 0.1)',
                    },
                },
            },
        }
    </script>

    <!-- è‡ªå®šç¾©æ¨£å¼ -->
    <style>
        body { font-family: "YouTube Sans","Roboto", sans-serif; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .main-content { transition: margin-left 0.3s ease-in-out; }
        .sidebar.collapsed { transform: translateX(-100%); }
        .sidebar.collapsed + .main-content { margin-left: 0 !important; }
        @media (min-width: 1313px) { /* YouTube's breakpoint */
            .sidebar.collapsed + .main-content { margin-left: 72px !important; }
            .sidebar.collapsed { transform: translateX(0); width: 72px !important; }
            .sidebar.collapsed .sidebar-item-text { display: none; }
            .sidebar.collapsed .sidebar-title { display: none; }
        }
        .thumbnail-container { transition: transform 0.2s ease; }
        .video-card:hover .thumbnail-container { transform: scale(1.05); z-index: 10; border-radius: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .edit-btn { opacity: 0; transition: opacity 0.2s ease; }
        .thumbnail-container:hover .edit-btn { opacity: 1; }
        body.modal-open { overflow: hidden; }
    </style>
</head>
<body class="bg-[#f9f9f9] dark:bg-yt-black text-yt-black dark:text-white">

    <!-- HTML éª¨æ¶: é é¢çš„æ‰€æœ‰å¯è¦‹å…§å®¹ -->
    <header class="sticky top-0 z-40 flex items-center justify-between h-14 px-4 bg-white dark:bg-yt-black border-b border-gray-200 dark:border-yt-light-black">
        <div class="flex items-center">
            <button id="menu-toggle" class="p-2 mr-4 rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <a href="#" class="flex items-center">
                <i class="fab fa-youtube text-yt-red text-3xl"></i>
                <span class="font-semibold text-xl ml-1 tracking-tighter">YouTube</span>
                <sup class="text-xs text-yt-gray dark:text-yt-dark-gray ml-1">TW</sup>
            </a>
        </div>
        <div class="flex-1 flex justify-center px-4 max-w-2xl">
            <div class="w-full flex">
                <input id="project-input" type="text" placeholder="è¼¸å…¥ä¼åŠƒåç¨±..." class="w-full px-4 py-1.5 border border-gray-300 dark:border-gray-700 bg-transparent rounded-l-full focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                <button id="generate-btn" class="px-6 bg-gray-100 dark:bg-yt-light-black border-y border-r border-gray-300 dark:border-gray-700 rounded-r-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <button id="theme-toggle" class="p-2 w-10 h-10 rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black">
                <i class="fas fa-sun text-xl hidden dark:block"></i>
                <i class="fas fa-moon text-xl dark:hidden"></i>
            </button>
            <a href="stats.html" target="_blank" class="p-2 w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black" title="æŸ¥çœ‹çµ±è¨ˆ">
                <i class="fas fa-chart-bar text-xl"></i>
            </a>
            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center font-bold text-white">æ‚¨</div>
        </div>
    </header>

    <div class="flex" style="height: calc(100vh - 56px);">
        <aside id="sidebar" class="sidebar fixed top-14 left-0 w-60 h-full bg-white dark:bg-yt-black z-30 overflow-y-auto border-r border-gray-200 dark:border-yt-light-black">
            <nav class="p-3">
                <a href="#" class="flex items-center px-3 py-2.5 rounded-lg bg-gray-100 dark:bg-yt-light-black">
                    <i class="fas fa-home w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">é¦–é </span>
                </a>
                <a href="#" class="flex items-center px-3 py-2.5 mt-1 rounded-lg hover:bg-gray-100 dark:hover:bg-yt-light-black">
                    <i class="fas fa-compass w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">æ¢ç´¢</span>
                </a>
                <a href="#" class="flex items-center px-3 py-2.5 mt-1 rounded-lg hover:bg-gray-100 dark:hover:bg-yt-light-black">
                    <i class="fas fa-play-circle w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">è¨‚é–±å…§å®¹</span>
                </a>
            </nav>
        </aside>

        <main id="main-content" class="main-content flex-1 ml-60 p-6 overflow-y-auto">
            <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-x-4 gap-y-8"></div>
        </main>
    </div>

    <div id="edit-modal" class="fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-yt-light-black rounded-lg shadow-xl w-full max-w-lg p-6">
            <h2 class="text-xl font-bold mb-4">ç·¨è¼¯å½±ç‰‡</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-yt-gray dark:text-yt-dark-gray">æ¨™é¡Œ</label>
                    <input type="text" id="edit-title-input" class="w-full mt-1 p-2 border rounded dark:bg-[#121212] dark:border-yt-gray">
                </div>
                <div>
                    <label class="block text-sm font-medium text-yt-gray dark:text-yt-dark-gray">å°é¢é è¦½</label>
                    <canvas id="edit-thumbnail-canvas" class="w-full aspect-video mt-1 border dark:border-yt-gray rounded"></canvas>
                </div>
                <div class="flex items-center justify-between">
                    <button id="upload-thumbnail-btn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ä¸Šå‚³å°é¢</button>
                    <input type="file" id="upload-thumbnail-input" class="hidden" accept="image/*">
                    <button id="regenerate-thumbnail-btn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">é‡æ–°ç”Ÿæˆ</button>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-edit-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600">å–æ¶ˆ</button>
                <button id="save-edit-btn" class="px-4 py-2 bg-yt-red text-white rounded hover:bg-red-700">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- JavaScriptï¼šæ‰€æœ‰åŠŸèƒ½æ€§è…³æœ¬éƒ½æ”¾åœ¨ body çš„æœ€æœ«ç«¯ï¼Œä»¥ç¢ºä¿é é¢å…ƒç´ éƒ½å·²è¼‰å…¥ -->
    <script>
    // ===================================================================================
    // ===                           ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒè¨­å®šèˆ‡å…¨åŸŸè®Šæ•¸                           ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æ•´å€‹å°ˆæ¡ˆçš„ä¸­å¤®æ§åˆ¶å®¤ã€‚æˆ‘å€‘åœ¨é€™è£¡å®šç¾©èˆ‡å¾Œå°æºé€šçš„å¯†ç¢¼ã€å„²å­˜æ‰€æœ‰å½±ç‰‡çš„å€‰åº«ï¼Œä»¥åŠå„ç¨®è¨­å®šã€‚

    /**
     * @description èˆ‡ Google Apps Script å¾Œå°æºé€šçš„å°ˆå±¬ç¶²å€ã€‚
     * @instructions è«‹å°‡æ‚¨çš„ Apps Script ç¶²å€è²¼åœ¨é€™è£¡ã€‚
     */
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyIjJK9EzOHiZVFXgRthq9bu4MSvUGBE5Mtgyzmi1-fOuKVNLPORrufFNC_-9PaS9dC/exec';

    /**
     * @description å…¨å±€è®Šæ•¸ï¼Œç”¨ä¾†åœ¨è¨˜æ†¶é«”ä¸­å„²å­˜ç•¶å‰é é¢ä¸Šæ‰€æœ‰çš„å½±ç‰‡ç‰©ä»¶ã€‚
     * @type {Array<Object>}
     */
    let videos = [];

    /**
     * @description å…¨å±€è®Šæ•¸ï¼Œç”¨ä¾†è¨˜éŒ„ç•¶å‰æ­£åœ¨è¢«ç·¨è¼¯çš„å½±ç‰‡çš„IDã€‚
     * @type {string | null}
     */
    let currentEditingVideoId = null;
    
    /**
     * @description ã€å¯ä¿®æ”¹å€ã€‘ç”¨ä¾†éš¨æ©Ÿç”Ÿæˆé »é“åç¨±çš„åˆ—è¡¨ã€‚
     * @instructions æ‚¨å¯ä»¥éš¨æ„å¢åŠ ã€åˆªé™¤æˆ–ä¿®æ”¹é€™è£¡çš„é »é“åç¨±ã€‚
     */
    const channelNames = ["è¶…èƒ½å­¸å ‚", "æ€æƒ³éºµåŒ…", "è§€é»å¯¦é©—å®¤", "è…¦æ´å¤§é–‹", "çŸ¥è­˜è† å›Š", "æ¥µå®¢ç©å®¶", "ç”Ÿæ´»é§­å®¢"];

    /**
     * @description ã€å¯ä¿®æ”¹å€ã€‘æˆ‘å€‘çš„ã€Œæ¨™é¡Œé›¶ä»¶è‡ªåŠ©é¤ã€ã€‚æ‰€æœ‰éš¨æ©Ÿæ¨™é¡Œéƒ½å¾é€™è£¡çµ„åˆè€Œæˆã€‚
     * @instructions é€™æ˜¯æœ€æ ¸å¿ƒçš„å‰µæ„ä¾†æºï¼æ‚¨å¯ä»¥è‡ªç”±ä¿®æ”¹ã€å¢åŠ å„ç¨®é›¶ä»¶ï¼Œæ‰“é€ æ‚¨å°ˆå±¬çš„æ¨™é¡Œé¢¨æ ¼ã€‚
     *   [P] æœƒè¢«æ›¿æ›æˆæ‚¨çš„ä¼åŠƒåç¨±ã€‚
     *   [N], [T], [R], [S], [C] ç­‰æœƒè¢«éš¨æ©Ÿæ›¿æ›æˆå°æ‡‰é›¶ä»¶åº«ä¸­çš„å…§å®¹ã€‚
     */
    const titleParts = {
        prefixes: ["ã€ç¡¬æ ¸ã€‘", "ã€æ·±åº¦è§£æã€‘", "ã€çµ‚æ¥µæŒ‡å—ã€‘", "[VLOG]", "ã€å®Œæ•´æ•™å­¸ã€‘", "ã€é–‹ç®±ã€‘", ""],
        corePatterns: [
            "é—œæ–¼ã€Œ[P]ã€ä½ ä¸çŸ¥é“çš„[N]å€‹ç§˜å¯†", "æˆ‘èŠ±äº†[T]æŒ‘æˆ°ã€Œ[P]ã€", "ã€Œ[P]ã€çœŸçš„å€¼å¾—å—ï¼Ÿ",
            "ä¸€å€‹å½±ç‰‡è®“ä½ å®Œå…¨ææ‡‚ã€Œ[P]ã€", "ã€Œ[P]ã€VSã€Œ[C]ã€çš„ä¸–ç´€å°æ±ºï¼", "å¦‚ä½•ç”¨ã€Œ[P]ã€é”åˆ°[R]ï¼Ÿ",
            "ç•¶ã€Œ[P]ã€é‡åˆ°[S]æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ"
        ],
        time: ["1000å°æ™‚", "7å¤©", "24å°æ™‚", "ä¸€å€‹æœˆ", "30åˆ†é˜"],
        numbers: ["3", "5", "7", "10"],
        results: ["è²¡å¯Œè‡ªç”±", "æ•ˆç‡å€å¢", "å¾¹åº•æ”¹è®Šäººç”Ÿ", "é©šäººæˆæœ"],
        surprises: ["AI", "ç§‘å­¸", "ç‰©ç†å­¸", "å“²å­¸"],
        hooks: ["...çµæœç«Ÿç„¶æ˜¯é€™æ¨£ï¼", "...çœ‹å®Œé¡›è¦†ä¸‰è§€ï¼", "...æ²’æƒ³åˆ°æœƒç™¼ç”Ÿé€™ç¨®äº‹ï¼", ""],
        emojis: ["ğŸ˜±", "ğŸ”¥", "ğŸš€", "ğŸ¤¯", "ğŸ’¡", "ğŸ’°", "ğŸ¤”"],
        styles: ['mrbeast', 'laogao', 'tech'] // å°æ‡‰å°é¢é¢¨æ ¼
    };


    // ===================================================================================
    // ===                           ç¬¬äºŒéƒ¨åˆ†ï¼šç¨‹å¼é€²å…¥é»èˆ‡åˆå§‹åŒ–                           ===
    // ===================================================================================
    // èªªæ˜ï¼šç•¶æ•´å€‹ HTML é é¢ä¸‹è¼‰å®Œæˆå¾Œï¼Œç€è¦½å™¨æœƒå¾é€™è£¡é–‹å§‹åŸ·è¡Œæˆ‘å€‘çš„ç¨‹å¼ã€‚

    /**
     * @description é é¢è¼‰å…¥å®Œæˆå¾Œçš„ä¸»å‡½æ•¸ï¼Œè² è²¬å”èª¿æ‰€æœ‰åˆå§‹åŒ–å·¥ä½œã€‚
     */
    document.addEventListener('DOMContentLoaded', () => {
        // æŒ‰ç…§é †åºï¼Œä¸€æ­¥æ­¥åœ°è®“é é¢æ´»èµ·ä¾†
        loadData();                 // 1. çœ‹çœ‹ç€è¦½å™¨æœ‰æ²’æœ‰å­˜èˆŠè³‡æ–™ï¼Œæœ‰çš„è©±å°±æ‹¿å‡ºä¾†
        renderAllVideos();          // 2. å°‡æ‰€æœ‰å½±ç‰‡è³‡æ–™æ¸²æŸ“æˆç•«é¢
        initEventListeners();       // 3. ç‚ºé é¢ä¸Šçš„æ‰€æœ‰æŒ‰éˆ•ç¶å®šå°æ‡‰çš„åŠŸèƒ½
        initTheme();                // 4. åˆå§‹åŒ–æ·±è‰²/æ·ºè‰²æ¨¡å¼
        initSidebar();              // 5. åˆå§‹åŒ–å´é‚Šæ¬„çš„æ”¶åˆåŠŸèƒ½
    });

        // ===== æœ¬åœ°æ•¸æ“šè™•ç† =====
        function loadData() {
            const savedData = localStorage.getItem('youtubeSimulatorFinal');
            if (savedData) {
                // å¦‚æœæœ‰èˆŠè³‡æ–™ï¼Œå°±è®€å–å®ƒ
        videos = JSON.parse(savedData);
    } else {
        // å¦‚æœæ²’æœ‰èˆŠè³‡æ–™ï¼Œå°±åˆå§‹åŒ–ä¸€å€‹ä¹¾æ·¨çš„ç©ºé™£åˆ—
        videos = []; 
            }
        }

        function saveData() {
            localStorage.setItem('youtubeSimulatorFinal', JSON.stringify(videos));
        }

        // ===== äº‹ä»¶ç›£è½å™¨ =====
        function initEventListeners() {
            document.getElementById('generate-btn').addEventListener('click', handleGenerateClick);
            document.getElementById('project-input').addEventListener('keypress', e => e.key === 'Enter' && handleGenerateClick());
            
            document.getElementById('cancel-edit-btn').addEventListener('click', closeEditModal);
            document.getElementById('save-edit-btn').addEventListener('click', handleSaveEdit);
            document.getElementById('upload-thumbnail-btn').addEventListener('click', () => document.getElementById('upload-thumbnail-input').click());
            document.getElementById('upload-thumbnail-input').addEventListener('change', handleThumbnailUpload);
            document.getElementById('regenerate-thumbnail-btn').addEventListener('click', handleRegenerateThumbnail);
        }

        // ===== æ¸²æŸ“é‚è¼¯ =====
        function renderAllVideos() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';
            videos.forEach(video => grid.appendChild(createVideoCard(video)));
        }        

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card flex flex-col cursor-pointer';
            card.dataset.videoId = video.id;

            card.innerHTML = `
                <div class="relative thumbnail-container rounded-xl overflow-hidden aspect-video bg-gray-200 dark:bg-yt-light-black">
                    <img src="${video.thumbnail}" class="w-full h-full object-cover" alt="${video.title}" />
                    <div class="absolute inset-0 voted-overlay flex items-center justify-center opacity-0 transition-opacity pointer-events-none bg-black bg-opacity-70">
                        <i class="fas fa-check text-white text-4xl"></i>
                    </div>
                    <button class="edit-btn absolute top-2 right-2 bg-black bg-opacity-60 text-white px-2 py-1 text-xs rounded hover:bg-opacity-80">ç·¨è¼¯</button>
                </div>
                <div class="flex items-start space-x-3 mt-3">
                    <div class="w-9 h-9 rounded-full flex-shrink-0" style="background-color: ${video.avatarColor};"></div>
                    <div>
                        <h3 class="font-bold text-base leading-snug line-clamp-2 video-title">${video.title}</h3>
                        <p class="text-sm text-yt-gray dark:text-yt-dark-gray mt-1">${video.channel}</p>
                        <p class="text-sm text-yt-gray dark:text-yt-dark-gray video-meta">è§€çœ‹æ¬¡æ•¸ï¼š${video.views}æ¬¡</p>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', handleVoteClick);
            card.querySelector('.edit-btn').addEventListener('click', e => {
                e.stopPropagation();
                openEditModal(video.id);
            });
            return card;
        }    

    // ===================================================================================
    // ===                          ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ (ä½¿ç”¨è€…äº’å‹•)                        ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯è™•ç†ä½¿ç”¨è€…ä¸»è¦æ“ä½œçš„åœ°æ–¹ï¼Œä¾‹å¦‚æ–°å¢ä¼åŠƒã€æŠ•ç¥¨ã€ç·¨è¼¯ç­‰ã€‚

    /**
     * @description è™•ç†ã€Œç”Ÿæˆã€æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ã€‚
     */
    function handleGenerateClick() {
        const input = document.getElementById('project-input');
        const projectName = input.value.trim();
        if (!projectName) return; // å¦‚æœæ²’è¼¸å…¥å…§å®¹ï¼Œå°±ä»€éº¼éƒ½ä¸åš

        const newVideos = generateVideoVariations(projectName); // è«‹å‰µæ„å¼•æ“ç”Ÿæˆæ–°å½±ç‰‡
        videos.unshift(...newVideos); // ä½¿ç”¨ unshift å°‡æ–°å½±ç‰‡åŠ åˆ°é™£åˆ—çš„ã€Œæœ€å‰é¢ã€
        saveData();     // å„²å­˜æ›´æ–°å¾Œçš„å½±ç‰‡åˆ—è¡¨
        renderAllVideos();            // é‡æ–°æ¸²æŸ“æ•´å€‹ç•«é¢
        input.value = '';             // æ¸…ç©ºè¼¸å…¥æ¡†
    }

    /**
     * @description è™•ç†ã€Œå½±ç‰‡å¡ç‰‡ã€çš„é»æ“Šäº‹ä»¶ï¼ˆæŠ•ç¥¨ï¼‰ã€‚
     * @param {MouseEvent} event - é»æ“Šäº‹ä»¶ç‰©ä»¶
     */
    function handleVoteClick(event) {
        const card = event.currentTarget;
        const videoId = card.dataset.videoId;
        const videoIndex = videos.findIndex(v => v.id === videoId);
        if (videoIndex === -1) return; // å¦‚æœæ‰¾ä¸åˆ°å½±ç‰‡ï¼Œå°±ä»€éº¼éƒ½ä¸åš

        // 1. æ›´æ–°æ•¸æ“š
        videos[videoIndex].views++;
        
        // 2. æ›´æ–°ç•«é¢
        card.querySelector('.video-meta').textContent = `è§€çœ‹æ¬¡æ•¸ï¼š${videos[videoIndex].views}æ¬¡`; // æ›´æ–°è¨ˆæ•¸
        saveData();

        const overlay = card.querySelector('.voted-overlay');
        overlay.style.opacity = '1'; // é¡¯ç¤ºæŠ•ç¥¨æˆåŠŸå‹•ç•«
        setTimeout(() => { overlay.style.opacity = '0'; }, 1500); // 1.5ç§’å¾Œæ·¡å‡º

        if (SCRIPT_URL && SCRIPT_URL.includes('macros')) {
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        projectName: videos[videoIndex].projectName,
                        videoTitle: videos[videoIndex].title,
                        thumbnailID: videos[videoIndex].thumbnailId
                    })
                }).catch(err => console.error("å¾Œå°ç™¼é€å¤±æ•—:", err));
            }
    }

    /**
     * @description è™•ç†ã€Œç·¨è¼¯ã€æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ï¼Œæ‰“é–‹ç·¨è¼¯è¦–çª—ã€‚
     * @param {string} videoId - è¦ç·¨è¼¯çš„å½±ç‰‡ID
     */
    function openEditModal(videoId) {
        currentEditingVideoId = videoId;
        const video = videos.find(v => v.id === videoId);
        if (!video) return;

        // å°‡å½±ç‰‡çš„ç¾æœ‰è³‡æ–™ï¼Œå¡«å…¥ç·¨è¼¯è¦–çª—çš„å°æ‡‰æ¬„ä½
        document.getElementById('edit-title-input').value = video.title;
        const canvas = document.getElementById('edit-thumbnail-canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.crossOrigin = "Anonymous"; // å…è¨±è·¨ä¾†æºåœ–ç‰‡ç¹ªè£½
        img.onload = () => { // åœ–ç‰‡è¼‰å…¥å¾Œæ‰åŸ·è¡Œç¹ªåœ–
            canvas.width = img.naturalWidth > 500 ? 500 : img.naturalWidth;
            canvas.height = canvas.width * (img.naturalHeight / img.naturalWidth);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = video.thumbnail;
        
        // é¡¯ç¤ºç·¨è¼¯è¦–çª—
        document.getElementById('edit-modal').classList.remove('hidden');
        document.body.classList.add('modal-open'); // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
    }

    function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.body.classList.remove('modal-open');
        }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œå„²å­˜ã€æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
     */
    function handleSaveEdit() {
        const videoIndex = videos.findIndex(v => v.id === currentEditingVideoId);
        if (videoIndex === -1) return;

        // å¾ç·¨è¼¯è¦–çª—ä¸­ç²å–æ–°çš„è³‡æ–™
        videos[videoIndex].title = document.getElementById('edit-title-input').value;
            const canvas = document.getElementById('edit-thumbnail-canvas');
            videos[videoIndex].thumbnail = canvas.toDataURL('image/jpeg');
        
        saveData();
        renderAllVideos();
        closeEditModal();
    }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œä¸Šå‚³å°é¢ã€åŠŸèƒ½ã€‚
     * @param {Event} event - æª”æ¡ˆé¸æ“‡äº‹ä»¶ç‰©ä»¶
     */
    function handleThumbnailUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = e => {
            const canvas = document.getElementById('edit-thumbnail-canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
                canvas.width = 640; 
                canvas.height = 360; // å°‡ä¸Šå‚³çš„åœ–ç‰‡æ¨™æº–åŒ–ç‚º16:9
                ctx.drawImage(img, 0, 0, 640, 360);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œé‡æ–°ç”Ÿæˆã€æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
     */
    function handleRegenerateThumbnail() {
        const video = videos.find(v => v.id === currentEditingVideoId);
        if (!video) return;
        const canvas = document.getElementById('edit-thumbnail-canvas');
        // ç›´æ¥åœ¨ç·¨è¼¯è¦–çª—çš„ç•«å¸ƒä¸Šï¼Œé‡æ–°ç•«ä¸€æ¬¡å°é¢
        generateThumbnailOnCanvas(canvas, video.projectName, video.thumbnailId);
    }

    // ===================================================================================
    // ===                          ç¬¬å››éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¥­å‹™é‚è¼¯ (å½±ç‰‡èˆ‡æ¨™é¡Œç”Ÿæˆ)                      ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æˆ‘å€‘å°ˆæ¡ˆçš„ã€Œå‰µæ„å¼•æ“ã€ï¼Œè² è²¬æ ¹æ“šä¼åŠƒåç¨±ï¼Œç”Ÿæˆå¤šæ¨£åŒ–çš„å½±ç‰‡è³‡æ–™ã€‚

    /**
     * @description æ ¹æ“šä¼åŠƒåç¨±ï¼Œç”Ÿæˆå¤šå€‹éš¨æ©Ÿçš„å½±ç‰‡æ¨™é¡Œèˆ‡å°é¢çµ„åˆã€‚
     * @param {string} projectName - ä½¿ç”¨è€…è¼¸å…¥çš„ä¼åŠƒåç¨±
     * @returns {Array<Object>} - åŒ…å«å¤šå€‹æ–°å½±ç‰‡ç‰©ä»¶çš„é™£åˆ—
     */
            function generateVideoVariations(projectName) {
            // 1. å»ºç«‹ä¸€å€‹è±å¯Œçš„ã€Œæ¨™é¡Œé»å­åº«ã€ã€‚é€™æ˜¯å”¯ä¸€æ–°å¢çš„è³‡æ–™ã€‚
            const titleIdeas = [
                `ã€ç¡¬æ ¸è§£æã€‘é—œæ–¼ã€Œ${projectName}ã€ä½ ä¸çŸ¥é“çš„3å€‹ç§˜å¯†`,
                `[VLOG] æˆ‘èŠ±äº†7å¤©ï¼Œåªç‚ºäº†ææ‡‚ã€Œ${projectName}ã€...çµæœç«Ÿç„¶æ˜¯é€™æ¨£ï¼`,
                `ã€Œ${projectName}ã€çœŸçš„å€¼å¾—å—ï¼Ÿä¸€å€‹èª å¯¦çš„æ·±åº¦è©•æ¸¬`,
                `ä¸€å€‹å½±ç‰‡è®“ä½ å®Œå…¨ææ‡‚ã€Œ${projectName}ã€çš„åº•å±¤é‚è¼¯`,
                `æˆ‘ç”¨ã€Œ${projectName}ã€æŒ‘æˆ°å‚³çµ±æ–¹æ³•ï¼Œæ²’æƒ³åˆ°... ğŸ˜±`,
                `ã€çµ‚æ¥µæŒ‡å—ã€‘å¾é›¶é–‹å§‹æŒæ¡ã€Œ${projectName}ã€`,
                `ç•¶ã€Œ${projectName}ã€é‡åˆ°AIï¼Œæœƒæ“¦å‡ºä»€éº¼ç«èŠ±ï¼ŸğŸ¤¯`,
                `ç‚ºä»€éº¼èªªã€Œ${projectName}ã€æ˜¯ä¸‹ä¸€å€‹é¢¨å£ï¼Ÿ`,
                `èŠ±äº†10è¬å…ƒï¼Œæˆ‘å€‘è²·ä¾†äº†é—œæ–¼ã€Œ${projectName}ã€çš„è¡€æ·šæ•™è¨“ ğŸ”¥`,
                `æ–°æ‰‹å¿…çœ‹ï¼é—œæ–¼ã€Œ${projectName}ã€æœ€å¸¸è¦‹çš„5å€‹èª¤å€`,
                `é–‹ç®±ã€Œ${projectName}ã€ï¼šå®ƒçœŸçš„åƒå‚³èªªä¸­é‚£éº¼ç¥å—ï¼Ÿ`,
                `ã€Œ${projectName}ã€çš„ç¥•å²ï¼šä¸€æ®µä¸ç‚ºäººçŸ¥çš„éå»`
            ];
            
            // é€™æ˜¯æ‚¨åŸæœ¬å°±æœ‰çš„å°é¢é¢¨æ ¼åº«ï¼Œæˆ‘å€‘ä¿ç•™å®ƒã€‚
            const styles = ['mrbeast', 'laogao', 'tech'];

            // 2. éš¨æ©Ÿæ‰“äº‚æˆ‘å€‘çš„ã€Œæ¨™é¡Œé»å­åº«ã€ã€‚
            for (let i = titleIdeas.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [titleIdeas[i], titleIdeas[j]] = [titleIdeas[j], titleIdeas[i]];
            }

            // 3. å¾æ‰“äº‚å¾Œçš„é»å­åº«ä¸­ï¼Œé¸å–å‰3å€‹ï¼Œä¸¦å°‡å®ƒå€‘æ‰“åŒ…æˆæ‚¨åŸæœ¬ç¨‹å¼ç¢¼å¯ä»¥è­˜åˆ¥çš„ `templates` æ ¼å¼ã€‚
            const selectedTemplates = titleIdeas.slice(0, 3).map((idea, index) => {
                return {
                    t: idea, // æ¨™é¡Œå…§å®¹
                    style: styles[index % styles.length] // å°é¢é¢¨æ ¼ï¼Œå¾ªç’°ä½¿ç”¨
                };
            });

            // 4. ã€æœ€é—œéµçš„ä¸€æ­¥ã€‘æˆ‘å€‘ä½¿ç”¨æ‚¨åŸæœ¬æª”æ¡ˆä¸­ï¼Œé‚£æ®µè¢«è­‰æ˜å¯ä»¥100%æ­£å¸¸é‹ä½œçš„ .map() é‚è¼¯ï¼Œä¾†è™•ç†æˆ‘å€‘å‰›å‰›ç”Ÿæˆçš„éš¨æ©Ÿæ¨¡æ¿ã€‚
            return selectedTemplates.map((tpl, i) => {
                // ä¸‹é¢é€™ä¸€è¡Œï¼Œå®Œå…¨éµå¾æ‚¨åŸå§‹ç¢¼çš„å‘¼å«æ–¹å¼ï¼Œç¢ºä¿ä¸æœƒæœ‰ä»»ä½•æ¥å£ä¸ç¬¦çš„å•é¡Œã€‚
                const thumbnailURL = generateThumbnailDataURL(projectName, tpl.style);
                
                return {
                    id: `vid_${Date.now()}_${i}`,
                    projectName: projectName,
                    title: tpl.t,
                    thumbnailId: tpl.style,
                    thumbnail: thumbnailURL,
                    channel: channelNames[Math.floor(Math.random() * channelNames.length)],
                    views: 0,
                    avatarColor: `hsl(${Math.random() * 360}, 60%, 50%)`,
                }
            });
        }

    // ===================================================================================
    // ===                            ç¬¬äº”éƒ¨åˆ†ï¼šè¼”åŠ©å·¥å…·å‡½æ•¸ (é›œé …)                          ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æä¾›å„ç¨®æ”¯æ´çš„å·¥å…·äººå‡½æ•¸ï¼Œä¾‹å¦‚å„²å­˜è³‡æ–™ã€ç¹ªè£½å°é¢ã€åˆå§‹åŒ–UIå…ƒä»¶ç­‰ã€‚        

    function generateThumbnailDataURL(text, style) {
            const canvas = document.createElement('canvas');
            generateThumbnailOnCanvas(canvas, text, style);
            return canvas.toDataURL('image/jpeg');
        }
        
    function generateThumbnailOnCanvas(canvas, text, style) {
            canvas.width = 640; canvas.height = 360; // 16:9
            const ctx = canvas.getContext('2d');
            const styles = {
                mrbeast: { bg: ['#f7b733', '#fc4a1a'], emoji: 'ğŸ˜±' },
                laogao: { bg: ['#2c3e50', '#3498db'], emoji: 'ğŸ‘ï¸' },
                tech: { bg: ['#111', '#555'], emoji: 'ğŸ’»' }
            };
            const s = styles[style] || styles.tech;
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, s.bg[0]); gradient.addColorStop(1, s.bg[1]);
            ctx.fillStyle = gradient; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.font = 'bold 48px "Microsoft JhengHei", sans-serif'; ctx.fillStyle = '#fff';
            ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 10;
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            ctx.font = '80px sans-serif'; ctx.shadowBlur = 0;
            ctx.fillText(s.emoji, 60, 70);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }        
        
    function initTheme() {
        const themeToggle = document.getElementById('theme-toggle');
        const docEl = document.documentElement;
        const applyTheme = (theme) => {
                if (theme === 'dark') docEl.classList.add('dark');
                else docEl.classList.remove('dark');
            };
            themeToggle.addEventListener('click', () => {
                const currentTheme = localStorage.getItem('theme') === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', currentTheme);
                applyTheme(currentTheme);
            });
            applyTheme(localStorage.getItem('theme') || 'light');
        }
        
    function initSidebar() {
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        let isMini = window.innerWidth < 1313;

        const applySidebarState = () => {
                if(isCollapsed){
                    sidebar.classList.add('collapsed');
                    mainContent.style.marginLeft = '0';
                } else {
                    sidebar.classList.remove('collapsed');
                    mainContent.style.marginLeft = '240px';
                }
            };
        
        menuToggle.addEventListener('click', () => {
                isCollapsed = !isCollapsed;
                applySidebarState();
            });
            window.addEventListener('resize', () => {
                isCollapsed = window.innerWidth < 1313;
                applySidebarState();
            });
            applySidebarState();
        }
    </script>
</body>
</html>