<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ä¼åŠƒæ¨¡æ“¬å™¨</title>
    
    <!-- å¤–éƒ¨è³‡æº: å…ˆè¼‰å…¥æ‰€æœ‰éœ€è¦çš„å¤–éƒ¨å‡½å¼åº« -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- TailwindCSS é…ç½® -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'yt-red': '#FF0000',
                        'yt-black': '#0F0F0F',
                        'yt-white': '#FFFFFF',
                        'yt-light-black': '#272727',
                        'yt-gray': '#606060',
                        'yt-dark-gray': '#AAAAAA',
                        'yt-hover-bg': 'rgba(255, 255, 255, 0.1)',
                        'yt-light-hover-bg': 'rgba(0, 0, 0, 0.1)',
                    },
                },
            },
        }
    </script>

    <!-- è‡ªå®šç¾©æ¨£å¼ -->
    <style>
        body { font-family: "YouTube Sans","Roboto", sans-serif;-webkit-font-smoothing:antialiased }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .main-content { transition: margin-left 0.3s ease-in-out; }
        .sidebar.collapsed { transform: translateX(-100%); }
        .sidebar.collapsed + .main-content { margin-left: 0 !important; }
        @media (min-width: 1313px) { /* YouTube's breakpoint */
            .sidebar.collapsed + .main-content { margin-left: 72px !important; }
            .sidebar.collapsed { transform: translateX(0); width: 72px !important; }
            .sidebar.collapsed .sidebar-item-text { display: none; }
            .sidebar.collapsed .sidebar-title { display: none; }
        }
        .thumbnail-container { transition: transform 0.2s ease; }
        .video-card:hover .thumbnail-container { transform: scale(1.05); z-index: 10; border-radius: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .edit-btn { opacity: 0; transition: opacity 0.2s ease; }
        .thumbnail-container:hover .edit-btn { opacity: 1; }
        body.modal-open { overflow: hidden; }
    </style>
</head>
<body class="bg-[#f9f9f9] dark:bg-yt-black text-yt-black dark:text-white">

    <!-- HTML éª¨æ¶: é é¢çš„æ‰€æœ‰å¯è¦‹å…§å®¹ -->
    <header class="sticky top-0 z-40 flex items-center justify-between h-14 px-4 bg-white dark:bg-yt-black border-b border-gray-200 dark:border-yt-light-black">
        <div class="flex items-center">
            <button id="menu-toggle" class="p-2 mr-4 rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <a href="#" class="flex items-center">
                <i class="fab fa-youtube text-yt-red text-3xl"></i>
                <span class="font-semibold text-xl ml-1 tracking-tighter">YouTube</span>
                <sup class="text-xs text-yt-gray dark:text-yt-dark-gray ml-1">TW</sup>
            </a>
        </div>
        <div class="flex-1 flex justify-center px-4 max-w-2xl">
            <div class="w-full flex">
                <input id="project-input" type="text" placeholder="è¼¸å…¥ä¼åŠƒåç¨±..." class="w-full px-4 py-1.5 border border-gray-300 dark:border-gray-700 bg-transparent rounded-l-full focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                <button id="generate-btn" class="px-6 bg-gray-100 dark:bg-yt-light-black border-y border-r border-gray-300 dark:border-gray-700 rounded-r-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <button id="theme-toggle" class="p-2 w-10 h-10 rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black">
                <i class="fas fa-sun text-xl hidden dark:block"></i>
                <i class="fas fa-moon text-xl dark:hidden"></i>
            </button>
            <a href="stats.html" target="_blank" class="p-2 w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-yt-light-black" title="æŸ¥çœ‹çµ±è¨ˆ">
                <i class="fas fa-chart-bar text-xl"></i>
            </a>
            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center font-bold text-white">æ‚¨</div>
        </div>
    </header>

    <div class="flex" style="height: calc(100vh - 56px);">
        <aside id="sidebar" class="sidebar fixed top-14 left-0 w-60 h-full bg-white dark:bg-yt-black z-30 overflow-y-auto border-r border-gray-200 dark:border-yt-light-black">
            <nav class="p-3">
                <a href="#" class="flex items-center px-3 py-2.5 rounded-lg bg-gray-100 dark:bg-yt-light-black">
                    <i class="fas fa-home w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">é¦–é </span>
                </a>
                <a href="#" class="flex items-center px-3 py-2.5 mt-1 rounded-lg hover:bg-gray-100 dark:hover:bg-yt-light-black">
                    <i class="fas fa-compass w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">æ¢ç´¢</span>
                </a>
                <a href="#" class="flex items-center px-3 py-2.5 mt-1 rounded-lg hover:bg-gray-100 dark:hover:bg-yt-light-black">
                    <i class="fas fa-play-circle w-8 text-center text-xl"></i><span class="ml-4 font-medium sidebar-item-text">è¨‚é–±å…§å®¹</span>
                </a>
            </nav>
        </aside>

        <main id="main-content" class="main-content ml-60 p-6 overflow-y-auto">
             <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-x-4 gap-y-8"></div>
             <div id="status-display" class="text-center text-yt-gray py-20"><i class="fas fa-spinner fa-spin text-4xl"></i><p class="mt-2">æ­£åœ¨å¾é›²ç«¯åŒæ­¥è³‡æ–™...</p></div>
        </main>
    </div>

    <div id="edit-modal" class="fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-yt-light-black rounded-lg shadow-xl w-full max-w-lg p-6">
            <h2 class="text-xl font-bold mb-4">ç·¨è¼¯å½±ç‰‡</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-yt-gray dark:text-yt-dark-gray">æ¨™é¡Œ</label>
                    <input type="text" id="edit-title-input" class="w-full mt-1 p-2 border rounded dark:bg-[#121212] dark:border-yt-gray">
                </div>
                <div>
                    <label class="block text-sm font-medium text-yt-gray dark:text-yt-dark-gray">å°é¢é è¦½</label>
                    <canvas id="edit-thumbnail-canvas" class="w-full aspect-video mt-1 border dark:border-yt-gray rounded"></canvas>
                </div>
                <div class="flex items-center justify-between">
                    <button id="upload-thumbnail-btn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ä¸Šå‚³å°é¢</button>
                    <input type="file" id="upload-thumbnail-input" class="hidden" accept="image/*">
                    <button id="regenerate-thumbnail-btn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">é‡æ–°ç”Ÿæˆ</button>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-edit-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600">å–æ¶ˆ</button>
                <button id="save-edit-btn" class="px-4 py-2 bg-yt-red text-white rounded hover:bg-red-700">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- JavaScriptï¼šæ‰€æœ‰åŠŸèƒ½æ€§è…³æœ¬éƒ½æ”¾åœ¨ body çš„æœ€æœ«ç«¯ï¼Œä»¥ç¢ºä¿é é¢å…ƒç´ éƒ½å·²è¼‰å…¥ -->
    <script>
    // ===================================================================================
    // ===                           ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒè¨­å®šèˆ‡å…¨åŸŸè®Šæ•¸                           ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æ•´å€‹å°ˆæ¡ˆçš„ä¸­å¤®æ§åˆ¶å®¤ã€‚æˆ‘å€‘åœ¨é€™è£¡å®šç¾©èˆ‡å¾Œå°æºé€šçš„å¯†ç¢¼ã€å„²å­˜æ‰€æœ‰å½±ç‰‡çš„å€‰åº«ï¼Œä»¥åŠå„ç¨®è¨­å®šã€‚

    /**
     * @description èˆ‡ Google Apps Script å¾Œå°æºé€šçš„å°ˆå±¬ç¶²å€ã€‚
     * @instructions è«‹å°‡æ‚¨çš„ Apps Script ç¶²å€è²¼åœ¨é€™è£¡ã€‚
     */
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxwEBR7kUfAfXJ9gVEDZ72zPJUhoXYspN7-Px--kiWsEXuk364VL88ZonCPamim-goy4Q/exec';

    /**
     * @description å…¨å±€è®Šæ•¸ï¼Œç”¨ä¾†åœ¨è¨˜æ†¶é«”ä¸­å„²å­˜ç•¶å‰é é¢ä¸Šæ‰€æœ‰çš„å½±ç‰‡ç‰©ä»¶ã€‚
     * @type {Array<Object>}
     */
    let videos = [];

    /**
     * @description å…¨å±€è®Šæ•¸ï¼Œç”¨ä¾†è¨˜éŒ„ç•¶å‰æ­£åœ¨è¢«ç·¨è¼¯çš„å½±ç‰‡çš„IDã€‚
     * @type {string | null}
     */
    let currentEditingVideoId = null;
    
    /**
     * @description ã€å¯ä¿®æ”¹å€ã€‘ç”¨ä¾†éš¨æ©Ÿç”Ÿæˆé »é“åç¨±çš„åˆ—è¡¨ã€‚
     * @instructions æ‚¨å¯ä»¥éš¨æ„å¢åŠ ã€åˆªé™¤æˆ–ä¿®æ”¹é€™è£¡çš„é »é“åç¨±ã€‚
     */
    const channelNames = ["è¶…èƒ½å­¸å ‚", "æ€æƒ³éºµåŒ…", "è§€é»å¯¦é©—å®¤", "è…¦æ´å¤§é–‹", "çŸ¥è­˜è† å›Š", "æ¥µå®¢ç©å®¶", "ç”Ÿæ´»é§­å®¢"];

    /**
     * @description ã€å¯ä¿®æ”¹å€ã€‘æˆ‘å€‘çš„ã€Œæ¨™é¡Œé›¶ä»¶è‡ªåŠ©é¤ã€ã€‚æ‰€æœ‰éš¨æ©Ÿæ¨™é¡Œéƒ½å¾é€™è£¡çµ„åˆè€Œæˆã€‚
     * @instructions é€™æ˜¯æœ€æ ¸å¿ƒçš„å‰µæ„ä¾†æºï¼æ‚¨å¯ä»¥è‡ªç”±ä¿®æ”¹ã€å¢åŠ å„ç¨®é›¶ä»¶ï¼Œæ‰“é€ æ‚¨å°ˆå±¬çš„æ¨™é¡Œé¢¨æ ¼ã€‚
     *   [P] æœƒè¢«æ›¿æ›æˆæ‚¨çš„ä¼åŠƒåç¨±ã€‚
     *   [N], [T], [R], [S], [C] ç­‰æœƒè¢«éš¨æ©Ÿæ›¿æ›æˆå°æ‡‰é›¶ä»¶åº«ä¸­çš„å…§å®¹ã€‚
     */
    const titleParts = {
        prefixes: ["ã€ç¡¬æ ¸ã€‘", "ã€æ·±åº¦è§£æã€‘", "ã€çµ‚æ¥µæŒ‡å—ã€‘", "[VLOG]", "ã€å®Œæ•´æ•™å­¸ã€‘", "ã€é–‹ç®±ã€‘", ""],
        corePatterns: [
            "é—œæ–¼ã€Œ[P]ã€ä½ ä¸çŸ¥é“çš„[N]å€‹ç§˜å¯†", "æˆ‘èŠ±äº†[T]æŒ‘æˆ°ã€Œ[P]ã€", "ã€Œ[P]ã€çœŸçš„å€¼å¾—å—ï¼Ÿ",
            "ä¸€å€‹å½±ç‰‡è®“ä½ å®Œå…¨ææ‡‚ã€Œ[P]ã€", "ã€Œ[P]ã€VSã€Œ[C]ã€çš„ä¸–ç´€å°æ±ºï¼", "å¦‚ä½•ç”¨ã€Œ[P]ã€é”åˆ°[R]ï¼Ÿ",
            "ç•¶ã€Œ[P]ã€é‡åˆ°[S]æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ"
        ],
        time: ["1000å°æ™‚", "7å¤©", "24å°æ™‚", "ä¸€å€‹æœˆ", "30åˆ†é˜"],
        numbers: ["3", "5", "7", "10"],
        results: ["è²¡å¯Œè‡ªç”±", "æ•ˆç‡å€å¢", "å¾¹åº•æ”¹è®Šäººç”Ÿ", "é©šäººæˆæœ"],
        surprises: ["AI", "ç§‘å­¸", "ç‰©ç†å­¸", "å“²å­¸"],
        hooks: ["...çµæœç«Ÿç„¶æ˜¯é€™æ¨£ï¼", "...çœ‹å®Œé¡›è¦†ä¸‰è§€ï¼", "...æ²’æƒ³åˆ°æœƒç™¼ç”Ÿé€™ç¨®äº‹ï¼", ""],
        emojis: ["ğŸ˜±", "ğŸ”¥", "ğŸš€", "ğŸ¤¯", "ğŸ’¡", "ğŸ’°", "ğŸ¤”"],
        competitors: ['å‚³çµ±æ–¹æ³•', 'ä¸é™é‡‘é¡'],
        styles: ['mrbeast', 'laogao', 'tech'] // å°æ‡‰å°é¢é¢¨æ ¼
    };


    // ===================================================================================
    // ===                           ç¬¬äºŒéƒ¨åˆ†ï¼šç¨‹å¼é€²å…¥é»èˆ‡åˆå§‹åŒ– (æµç¨‹æ”¹é€ ç‰ˆ)               ===
    // ===================================================================================

    /**
     * @description ä½¿ç”¨ async/await èªæ³•ï¼Œç¢ºä¿æˆ‘å€‘çš„åˆå§‹åŒ–æµç¨‹æ˜¯ã€ŒåŒæ­¥ã€çš„ï¼Œä¸€æ­¥åšå®Œå†åšä¸‹ä¸€æ­¥ã€‚
     */
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            console.log("é–‹å§‹åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼...");
            initUI(); // å…ˆåˆå§‹åŒ–ç„¡é—œæ•¸æ“šçš„UIï¼Œä¾‹å¦‚ä¸»é¡Œå’Œå´é‚Šæ¬„
            await loadVideosFromCloud(); // ç­‰å¾…å¾é›²ç«¯è¼‰å…¥æ‰€æœ‰å½±ç‰‡è³‡æ–™
            renderAllVideos(); // æ ¹æ“šé›²ç«¯è³‡æ–™æ¸²æŸ“ç•«é¢
            initEventListeners(); // ç‚ºæ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬æ–°æ¸²æŸ“çš„ï¼‰ç¶å®šäº‹ä»¶
            console.log("æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å®Œæˆï¼");
        } catch (error) {
            // å¦‚æœåœ¨æ•´å€‹åˆå§‹åŒ–æµç¨‹ä¸­ç™¼ç”Ÿä»»ä½•éŒ¯èª¤ï¼Œéƒ½åœ¨é€™è£¡æ•ç²ä¸¦æé†’ä½¿ç”¨è€…
            console.error("åˆå§‹åŒ–å¤±æ•—:", error);
            alert("é é¢åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹å˜—è©¦å¼·åˆ¶é‡æ–°æ•´ç†ã€‚éŒ¯èª¤è¨Šæ¯ï¼š" + error.message);
        }
    });

    /**
     * @description ã€æ”¹é€ å¾Œã€‘æ•¸æ“šè™•ç†å‡½æ•¸ã€‚å®ƒç¾åœ¨åªè² è²¬ä¸€ä»¶äº‹ï¼šæº–å‚™å¥½ videos é€™å€‹å…¨åŸŸè®Šæ•¸ã€‚
     * @returns {Promise<void>} - å›å‚³ä¸€å€‹ Promiseï¼Œè®“ä¸Šå±¤çš„ await çŸ¥é“ä½•æ™‚å®Œæˆã€‚
     */
    /*async function loadVideosFromCloud() {
        const statusDisplay = document.getElementById('status-display');
        try {
            console.log("æ­£åœ¨å¾é›²ç«¯ç²å–å½±ç‰‡åˆ—è¡¨...");
            const response = await fetch(SCRIPT_URL);
            if (!response.ok) throw new Error(`ä¼ºæœå™¨éŒ¯èª¤: ${response.status}`);
            
            const result = await response.json();
            if (result.status === 'success') {
                console.log("æˆåŠŸå¾é›²ç«¯ç²å–è³‡æ–™:", result.data);
                videos = result.data || []; // ç¢ºä¿ videos è‡³å°‘æ˜¯ç©ºé™£åˆ—ï¼Œä¸æœƒæ˜¯ undefined         
            } else {
                throw new Error(result.message || 'å¾Œå°å›å‚³éŒ¯èª¤');
            }
        } catch (error) {
            console.error("å¾é›²ç«¯è¼‰å…¥å½±ç‰‡å¤±æ•—:", error);
            videos = []; // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œç¢ºä¿ videos æ˜¯ç©ºé™£åˆ—
            statusDisplay.innerHTML = `<i class="fas fa-exclamation-triangle text-4xl text-red-500"></i><p class="mt-2">ç„¡æ³•é€£æ¥åˆ°é›²ç«¯è³‡æ–™åº«ã€‚<br>${error.message}</p>`;
        }
    }*/

        function fetchWithJsonp(url) {
        return new Promise((resolve, reject) => {
            const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
            const script = document.createElement('script');
            
            // å°‡ callback å‡½å¼æ›è¼‰åˆ° window ä¸Šï¼Œä»¥ä¾¿å¾Œå°å›å‚³çš„è…³æœ¬å¯ä»¥å‘¼å«
            window[callbackName] = (data) => {
                delete window[callbackName]; // æ¸…ç†
                document.body.removeChild(script);
                resolve(data); // Promise æˆåŠŸï¼Œä¸¦å›å‚³æ•¸æ“š
            };

            script.src = `${url}${url.includes('?') ? '&' : '?'}callback=${callbackName}`;
            script.onerror = reject; // è™•ç†è¼‰å…¥å¤±æ•—çš„æƒ…æ³
            
            document.body.appendChild(script);
        });
    }

    /**
     * @description ã€æ”¹é€ ã€‘ç¾åœ¨ä½¿ç”¨ JSONP ä¾†ç²å–å½±ç‰‡åˆ—è¡¨ã€‚
     */
    async function loadVideosFromCloud() {
        const statusDisplay = document.getElementById('status-display');
        try {
            console.log("æ­£åœ¨ä½¿ç”¨ JSONP ç²å–å½±ç‰‡åˆ—è¡¨...");
            const result = await fetchWithJsonp(SCRIPT_URL);
            if (result.status === 'success') {
                videos = result.data || [];
            } else {
                throw new Error(result.message || 'å¾Œå°å›å‚³éŒ¯èª¤');
            }
        } catch (error) {
            console.error("å¾é›²ç«¯è¼‰å…¥å½±ç‰‡å¤±æ•— (JSONP):", error);
            videos = [];
            statusDisplay.innerHTML = `<i class="fas fa-exclamation-triangle text-4xl text-red-500"></i><p class="mt-2">ç„¡æ³•é€£æ¥åˆ°é›²ç«¯è³‡æ–™åº«ã€‚<br>${error.message}</p>`;
        }
    }


        // ===== äº‹ä»¶ç›£è½å™¨ =====
        function initEventListeners(){
            console.log("æ­£åœ¨ç¶å®šäº‹ä»¶ç›£è½å™¨...");
        // ç¶å®šç”ŸæˆæŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
        document.getElementById('generate-btn').addEventListener('click', handleGenerateClick);
        
        // ç¶å®šè¼¸å…¥æ¡†çš„ Enter éµäº‹ä»¶
        document.getElementById('project-input').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleGenerateClick();
            }
        });
        
        // ç¶å®šç·¨è¼¯è¦–çª—ç›¸é—œçš„äº‹ä»¶
        document.getElementById('cancel-edit-btn').addEventListener('click', closeEditModal);
        document.getElementById('save-edit-btn').addEventListener('click', handleSaveEdit);
        document.getElementById('upload-thumbnail-btn').addEventListener('click', () => {
        document.getElementById('upload-thumbnail-input').click();
        });
        document.getElementById('upload-thumbnail-input').addEventListener('change', handleThumbnailUpload);
        document.getElementById('regenerate-thumbnail-btn').addEventListener('click', handleRegenerateThumbnail);
        
        console.log("äº‹ä»¶ç›£è½å™¨ç¶å®šå®Œæˆï¼");
    }
        // ===== æ¸²æŸ“é‚è¼¯ =====
        function renderAllVideos() {
            console.log("æ­£åœ¨æ¸²æŸ“å½±ç‰‡åˆ—è¡¨ï¼Œå…±", videos.length, "å€‹å½±ç‰‡");
            const grid = document.getElementById('video-grid');
            const statusDisplay = document.getElementById('status-display');
        grid.innerHTML = '';
        if (videos.length === 0) {
            statusDisplay.innerHTML = `<i class="fas fa-clapperboard text-6xl"></i><p class="mt-2">è³‡æ–™åº«æ˜¯ç©ºçš„ï¼Œå¾æ–°å¢ç¬¬ä¸€å€‹ä¼åŠƒé–‹å§‹å§ï¼</p>`;
            statusDisplay.style.display = 'flex';
            statusDisplay.style.flexDirection = 'column';
            statusDisplay.style.justifyContent = 'center';
            statusDisplay.style.alignItems = 'center';
        } else {
            statusDisplay.style.display = 'none';
            const fragment = document.createDocumentFragment();
            videos.forEach(video => {
                const videoCard = createVideoCard(video);
                fragment.appendChild(videoCard);
            });
            grid.appendChild(fragment);
        }
        console.log("å½±ç‰‡åˆ—è¡¨æ¸²æŸ“å®Œæˆï¼");
    }        

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card flex flex-col cursor-pointer';
            card.dataset.videoId = video.id;

            card.innerHTML = `
                <div class="relative thumbnail-container rounded-xl overflow-hidden aspect-video bg-gray-200 dark:bg-yt-light-black">
                    <img src="${video.thumbnailDataUrl}" class="w-full h-full object-cover" alt="${video.title}" />
                    <div class="absolute inset-0 voted-overlay flex items-center justify-center opacity-0 transition-opacity pointer-events-none bg-black bg-opacity-70">
                        <i class="fas fa-check text-white text-4xl"></i>
                    </div>
                    <button class="edit-btn absolute top-2 right-2 bg-black bg-opacity-60 text-white px-2 py-1 text-xs rounded hover:bg-opacity-80">ç·¨è¼¯</button>
                </div>
                <div class="flex items-start space-x-3 mt-3">
                    <div class="w-9 h-9 rounded-full flex-shrink-0" style="background-color: ${video.avatarColor};"></div>
                    <div>
                        <h3 class="font-bold text-base leading-snug line-clamp-2 video-title">${video.title}</h3>
                        <p class="text-sm text-yt-gray dark:text-yt-dark-gray mt-1">${video.channel}</p>
                        <p class="text-sm text-yt-gray dark:text-yt-dark-gray video-meta">è§€çœ‹æ¬¡æ•¸ï¼š${video.views}æ¬¡</p>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', handleVoteClick);
            card.querySelector('.edit-btn').addEventListener('click', (event) => {
            event.stopPropagation(); // é˜²æ­¢è§¸ç™¼å¡ç‰‡çš„é»æ“Šäº‹ä»¶
            openEditModal(video.id);
        });
            return card;
        }    

    // ===================================================================================
    // ===                          ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½å‡½æ•¸ (ä½¿ç”¨è€…äº’å‹•)                        ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯è™•ç†ä½¿ç”¨è€…ä¸»è¦æ“ä½œçš„åœ°æ–¹ï¼Œä¾‹å¦‚æ–°å¢ä¼åŠƒã€æŠ•ç¥¨ã€ç·¨è¼¯ç­‰ã€‚

    /**
     * @description è™•ç†ã€Œç”Ÿæˆã€æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ã€‚
     */
    async function handleGenerateClick() {
        console.log("ä½¿ç”¨è€…é»æ“Šäº†ç”ŸæˆæŒ‰éˆ•");
        const input = document.getElementById('project-input');
        const projectName = input.value.trim();
        if (!projectName) {
            alert("è«‹è¼¸å…¥ä¼åŠƒåç¨±ï¼");
            return;
        }

        
            console.log("æ­£åœ¨ç”Ÿæˆä¼åŠƒ:", projectName);
            const newVideos = generateVideoVariations(projectName); // è«‹å‰µæ„å¼•æ“ç”Ÿæˆæ–°å½±ç‰‡
            videos.unshift(...newVideos); // ä½¿ç”¨ unshift å°‡æ–°å½±ç‰‡åŠ åˆ°é™£åˆ—çš„ã€Œæœ€å‰é¢ã€
            renderAllVideos();            // é‡æ–°æ¸²æŸ“æ•´å€‹ç•«é¢
            input.value = '';             // æ¸…ç©ºè¼¸å…¥æ¡†

            // å˜—è©¦åŒæ­¥åˆ°é›²ç«¯
        try {
            await postDataToBackend('addVideos', newVideos);
            console.log("æ–°å½±ç‰‡å·²æˆåŠŸåŒæ­¥åˆ°é›²ç«¯ã€‚");
            await loadVideosFromCloud();
            renderAllVideos();
        } catch (error) {
            console.error("åŒæ­¥æ–°å½±ç‰‡åˆ°é›²ç«¯å¤±æ•—:", error);
            alert("æœ¬åœ°æ–°å¢æˆåŠŸï¼Œä½†åŒæ­¥åˆ°é›²ç«¯å¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚");
            // å¦‚æœåŒæ­¥å¤±æ•—ï¼Œé‡æ–°å¾é›²ç«¯è¼‰å…¥è³‡æ–™ä»¥ä¿æŒä¸€è‡´æ€§
            
        }
    }
    /**
     * @description è™•ç†ã€Œå½±ç‰‡å¡ç‰‡ã€çš„é»æ“Šäº‹ä»¶ï¼ˆæŠ•ç¥¨ï¼‰ã€‚
     * @param {MouseEvent} event - é»æ“Šäº‹ä»¶ç‰©ä»¶
     */
    async function handleVoteClick(event) {
        const card = event.currentTarget;
        const videoId = card.dataset.videoId;
        const videoIndex = videos.findIndex(v => v.id === videoId);
        if (videoIndex === -1) {
            console.error("æ‰¾ä¸åˆ°å½±ç‰‡ID:", videoId);
            return;
        }

        console.log("ä½¿ç”¨è€…ç‚ºå½±ç‰‡æŠ•ç¥¨:", videos[videoIndex].title);

        // 1. å…ˆæ›´æ–°æœ¬åœ°æ•¸æ“šå’Œç•«é¢
        const originalViews = videos[videoIndex].views;
        videos[videoIndex].views++;
        card.querySelector('.video-meta').textContent = `è§€çœ‹æ¬¡æ•¸ï¼š${videos[videoIndex].views}æ¬¡`;
        
        // 2. é¡¯ç¤ºæŠ•ç¥¨æˆåŠŸå‹•ç•«
        const overlay = card.querySelector('.voted-overlay');
        if (overlay) {
            overlay.style.opacity = '1';
            setTimeout(() => { overlay.style.opacity = '0'; }, 1500); // 1.5ç§’å¾Œæ·¡å‡º
        }

        // 3. å˜—è©¦æ›´æ–°é ç«¯è³‡æ–™
        try {
            await postDataToBackend('updateVideo', videos[videoIndex]);
            console.log("æŠ•ç¥¨å·²æˆåŠŸåŒæ­¥åˆ°é›²ç«¯");
        } catch (error) {
            console.error("æŠ•ç¥¨åŒæ­¥å¤±æ•—:", error);
            // å¦‚æœåŒæ­¥å¤±æ•—ï¼Œå›æ»¾æœ¬åœ°æ•¸æ“š
            videos[videoIndex].views = originalViews;
            card.querySelector('.video-meta').textContent = `è§€çœ‹æ¬¡æ•¸ï¼š${videos[videoIndex].views}æ¬¡`;
            alert("æŠ•ç¥¨å¤±æ•—ï¼Œç„¡æ³•åŒæ­¥åˆ°é›²ç«¯ã€‚");
        }
    }

    /**
     * @description è™•ç†ã€Œç·¨è¼¯ã€æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ï¼Œæ‰“é–‹ç·¨è¼¯è¦–çª—ã€‚
     * @param {string} action - è¦åŸ·è¡Œçš„å‹•ä½œæŒ‡ä»¤ ('addVideos', 'updateVideo', etc.)
     * @param {Object|Array} data - è¦ç™¼é€çš„è³‡æ–™
     */
    async function postDataToBackend(action, data) {
        // å°‡å®Œæ•´çš„ payload ç‰©ä»¶å­—ä¸²åŒ–
        const payload = { action: action, data: data };
        const bodyString = JSON.stringify(payload);

        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: {
                    // ä½¿ç”¨ text/plain ä¾†é¿å… OPTIONS é æª¢è«‹æ±‚
                    'Content-Type': 'text/plain;charset=utf-8', 
                },
                body: bodyString
            });

            // æˆ‘å€‘ä¸æª¢æŸ¥å›æ‡‰ï¼Œå› ç‚ºå®ƒæœƒè¢«CORSé˜»æ“‹ã€‚æˆ‘å€‘å‡è¨­å®ƒæ˜¯æˆåŠŸçš„ã€‚
            // çœŸæ­£çš„æˆåŠŸèˆ‡å¦ï¼Œç”±ä¸‹ä¸€æ¬¡çš„ loadVideosFromCloud ä¾†é©—è­‰ã€‚
            console.log("POST è«‹æ±‚å·²ç™¼é€ã€‚");
        } catch (error) {
            // é€™å€‹ catch å¹¾ä¹ä¸æœƒè¢«è§¸ç™¼ï¼Œé™¤éæ˜¯ç¶²è·¯æ–·ç·š
            console.error("POST è«‹æ±‚ç™¼é€æ™‚ç™¼ç”Ÿç¶²è·¯éŒ¯èª¤:", error);
            throw error;
        }
    }


    function openEditModal(videoId) {
        console.log("æ‰“é–‹ç·¨è¼¯è¦–çª—ï¼Œå½±ç‰‡ID:", videoId);
        
        currentEditingVideoId = videoId;
        const video = videos.find(v => v.id === videoId);
        
        if (!video) {
            console.error("æ‰¾ä¸åˆ°è¦ç·¨è¼¯çš„å½±ç‰‡:", videoId);
            return;
        }

        // å°‡å½±ç‰‡çš„ç¾æœ‰è³‡æ–™ï¼Œå¡«å…¥ç·¨è¼¯è¦–çª—çš„å°æ‡‰æ¬„ä½
        document.getElementById('edit-title-input').value = video.title;
        const canvas = document.getElementById('edit-thumbnail-canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.crossOrigin = "Anonymous"; // å…è¨±è·¨ä¾†æºåœ–ç‰‡ç¹ªè£½
        img.onload = () => { // åœ–ç‰‡è¼‰å…¥å¾Œæ‰åŸ·è¡Œç¹ªåœ–
            canvas.width = img.naturalWidth > 500 ? 500 : img.naturalWidth;
            canvas.height = canvas.width * (img.naturalHeight / img.naturalWidth);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = video.thumbnailDataUrl;
        
        // é¡¯ç¤ºç·¨è¼¯è¦–çª—
        document.getElementById('edit-modal').classList.remove('hidden');
        document.body.classList.add('modal-open'); // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
    }

    function closeEditModal() {
            console.log("é—œé–‰ç·¨è¼¯è¦–çª—");
        document.getElementById('edit-modal').classList.add('hidden');
        document.body.classList.remove('modal-open');
        currentEditingVideoId = null;
        }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œå„²å­˜ã€æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
     */
    async function handleSaveEdit() {
        if (!currentEditingVideoId) {
            console.error("æ²’æœ‰æ­£åœ¨ç·¨è¼¯çš„å½±ç‰‡");
            return;
        }
        
        const videoIndex = videos.findIndex(v => v.id === currentEditingVideoId);
        if (videoIndex === -1) {
            console.error("æ‰¾ä¸åˆ°æ­£åœ¨ç·¨è¼¯çš„å½±ç‰‡");
            return;
        }

        console.log("æ­£åœ¨å„²å­˜ç·¨è¼¯çµæœ");

        // å…ˆå„²å­˜ä¸€ä»½èˆŠè³‡æ–™ï¼Œä»¥ä¾¿å¤±æ•—æ™‚å›æ»¾
        const oldVideo = JSON.parse(JSON.stringify(videos[videoIndex]));

        // å¾ç·¨è¼¯è¦–çª—ä¸­ç²å–æ–°çš„è³‡æ–™
        videos[videoIndex].title = document.getElementById('edit-title-input').value;
        const canvas = document.getElementById('edit-thumbnail-canvas');
        if (canvas.toDataURL) {
          videos[videoIndex].thumbnailDataUrl = canvas.toDataURL('image/jpeg', 0.7);
        }
        renderAllVideos();
        closeEditModal();
        // åœ¨èƒŒæ™¯æ›´æ–°å–®ä¸€å½±ç‰‡åˆ°å¾Œå°
        try {
            await postDataToBackend('updateVideo', videos[videoIndex]);
            console.log("å½±ç‰‡ç·¨è¼¯å·²æˆåŠŸåŒæ­¥åˆ°é›²ç«¯ã€‚");
        } catch (error) {
            console.error(`æ›´æ–°å½±ç‰‡ ${videos[videoIndex].id} å¤±æ•—:`, error);
            alert("å„²å­˜ç·¨è¼¯å¤±æ•—ï¼Œç„¡æ³•åŒæ­¥åˆ°é›²ç«¯ã€‚");
            // å›æ»¾åˆ°èˆŠè³‡æ–™
            videos[videoIndex] = oldVideo;
            renderAllVideos();
        }
    }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œä¸Šå‚³å°é¢ã€åŠŸèƒ½ã€‚
     * @param {Event} event - æª”æ¡ˆé¸æ“‡äº‹ä»¶ç‰©ä»¶
     */
    function handleThumbnailUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        console.log("ä½¿ç”¨è€…ä¸Šå‚³äº†æ–°çš„å°é¢åœ–ç‰‡");
        
        const reader = new FileReader();
        reader.onload = (e) => {
            const canvas = document.getElementById('edit-thumbnail-canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                // å°‡ä¸Šå‚³çš„åœ–ç‰‡æ¨™æº–åŒ–ç‚º 16:9 æ¯”ä¾‹
                canvas.width = 640; 
                canvas.height = 360;
                ctx.drawImage(img, 0, 0, 640, 360);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
    
    /**
     * @description è™•ç†ç·¨è¼¯è¦–çª—ä¸­çš„ã€Œé‡æ–°ç”Ÿæˆã€æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
     */
    function handleRegenerateThumbnail() {
        if (!currentEditingVideoId) return;
        
        const video = videos.find(v => v.id === currentEditingVideoId);
        if (!video) return;
        
        console.log("é‡æ–°ç”Ÿæˆå°é¢");
        
        const canvas = document.getElementById('edit-thumbnail-canvas');
        // ç›´æ¥åœ¨ç·¨è¼¯è¦–çª—çš„ç•«å¸ƒä¸Šï¼Œé‡æ–°ç•«ä¸€æ¬¡å°é¢
        generateThumbnailOnCanvas(canvas, video.projectName, video.thumbnailId);
    }

    // ===================================================================================
    // ===                          ç¬¬å››éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¥­å‹™é‚è¼¯ (å½±ç‰‡èˆ‡æ¨™é¡Œç”Ÿæˆ)                      ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æˆ‘å€‘å°ˆæ¡ˆçš„ã€Œå‰µæ„å¼•æ“ã€ï¼Œè² è²¬æ ¹æ“šä¼åŠƒåç¨±ï¼Œç”Ÿæˆå¤šæ¨£åŒ–çš„å½±ç‰‡è³‡æ–™ã€‚

    /**
     * @description æ ¹æ“šä¼åŠƒåç¨±ï¼Œç”Ÿæˆå¤šå€‹éš¨æ©Ÿçš„å½±ç‰‡æ¨™é¡Œèˆ‡å°é¢çµ„åˆã€‚
     * @param {string} projectName - ä½¿ç”¨è€…è¼¸å…¥çš„ä¼åŠƒåç¨±
     * @returns {Array<Object>} - åŒ…å«å¤šå€‹æ–°å½±ç‰‡ç‰©ä»¶çš„é™£åˆ—
     */
            function generateVideoVariations(projectName) {
            console.log("æ­£åœ¨ç‚ºä¼åŠƒç”Ÿæˆå½±ç‰‡è®ŠåŒ–:", projectName);
        
        const variations = [];
        const numToGenerate = 3; // æ¯æ¬¡ç”Ÿæˆ3å€‹å½±ç‰‡
        const usedPatterns = new Set(); // é¿å…é‡è¤‡çš„æ¨™é¡Œæ¨¡å¼
        
        /**
         * @description å¾æŒ‡å®šçš„é›¶ä»¶åº«ä¸­éš¨æ©Ÿé¸å–ä¸€å€‹å…ƒç´ ã€‚
         * @param {string} partName - é›¶ä»¶åº«çš„åç¨±ï¼ˆå¦‚ 'prefixes', 'time' ç­‰ï¼‰
         * @returns {string} - éš¨æ©Ÿé¸ä¸­çš„é›¶ä»¶
         */
        const randomPart = (partName) => {
            const parts = titleParts[partName];
            if (!parts || !Array.isArray(parts) || parts.length === 0) {
                console.warn(`è­¦å‘Šï¼šé›¶ä»¶åº« '${partName}' ä¸å­˜åœ¨æˆ–ç‚ºç©º`);
                return '';
            }
            return parts[Math.floor(Math.random() * parts.length)];
        };

        for (let i = 0; i < numToGenerate; i++) {
            // é¸æ“‡ä¸€å€‹å°šæœªä½¿ç”¨éçš„æ ¸å¿ƒæ¨™é¡Œæ¨¡å¼
            let corePattern;
            do {
                corePattern = randomPart('corePatterns');
            } while (usedPatterns.has(corePattern) && usedPatterns.size < titleParts.corePatterns.length);
            usedPatterns.add(corePattern);

            // çµ„åˆæœ€çµ‚æ¨™é¡Œ
            let finalTitle = `${randomPart('prefixes')} ${corePattern}`.trim()
                .replace(/\[P\]/g, projectName)           // æ›¿æ›ä¼åŠƒåç¨±
                .replace(/\[N\]/g, randomPart('numbers')) // æ›¿æ›æ•¸å­—
                .replace(/\[T\]/g, randomPart('time'))    // æ›¿æ›æ™‚é–“
                .replace(/\[R\]/g, randomPart('results')) // æ›¿æ›çµæœ
                .replace(/\[S\]/g, randomPart('surprises')) // æ›¿æ›é©šå–œå…ƒç´ 
                .replace(/\[C\]/g, randomPart('competitors')); // æ›¿æ›ç«¶çˆ­å°æ‰‹

            // 50% æ©Ÿç‡åŠ ä¸Š hookï¼ˆå¸å¼•äººçš„çµå°¾ï¼‰
            if (Math.random() > 0.5) {
                finalTitle += ` ${randomPart('hooks')}`;
            }

            // é¸æ“‡å°é¢é¢¨æ ¼
            const style = randomPart('styles');
            
            // å‰µå»ºå½±ç‰‡è³‡æ–™ç‰©ä»¶
            const videoData = {
                id: `vid_${Date.now()}_${i}`,
                projectName: projectName,
                title: finalTitle.trim(),
                thumbnailId: style,
                channel: channelNames[Math.floor(Math.random() * channelNames.length)],
                views: 0,
                avatarColor: `hsl(${Math.random() * 360}, 60%, 50%)` // éš¨æ©Ÿé ­åƒé¡è‰²
            };

            // ç”Ÿæˆå°é¢åœ–ç‰‡çš„ Data URL
            videoData.thumbnailDataUrl = generateThumbnailDataURL(videoData.projectName, videoData.thumbnailId);
            
            variations.push(videoData);
        }

        console.log("ç”Ÿæˆå®Œæˆï¼Œå…±", variations.length, "å€‹å½±ç‰‡è®ŠåŒ–");
        return variations;
    }

    // ===================================================================================
    // ===                            ç¬¬äº”éƒ¨åˆ†ï¼šè¼”åŠ©å·¥å…·å‡½æ•¸ (é›œé …)                          ===
    // ===================================================================================
    // èªªæ˜ï¼šé€™è£¡æ˜¯æä¾›å„ç¨®æ”¯æ´çš„å·¥å…·äººå‡½æ•¸ï¼Œä¾‹å¦‚å„²å­˜è³‡æ–™ã€ç¹ªè£½å°é¢ã€åˆå§‹åŒ–UIå…ƒä»¶ç­‰ã€‚        

    function generateThumbnailDataURL(text, style) {
        const canvas = document.createElement('canvas');
        generateThumbnailOnCanvas(canvas, text, style);
        return canvas.toDataURL('image/jpeg', 0.7);
    }
        
    function generateThumbnailOnCanvas(canvas, text, style) {
            canvas.width = 640; canvas.height = 360; // 16:9
            const ctx = canvas.getContext('2d');
            const styles = {
            mrbeast: { 
                bg: ['#f7b733', '#fc4a1a'], // æ©˜é»ƒæ¼¸å±¤
                emoji: 'ğŸ˜±',
                textColor: '#fff',
                shadowColor: 'rgba(0,0,0,0.8)'
            },
            laogao: { 
                bg: ['#2c3e50', '#3498db'], // è—ç°æ¼¸å±¤
                emoji: 'ğŸ‘ï¸',
                textColor: '#fff',
                shadowColor: 'rgba(0,0,0,0.6)'
            },
            tech: { 
                bg: ['#111', '#555'], // é»‘ç°æ¼¸å±¤
                emoji: 'ğŸ’»',
                textColor: '#00ff00',
                shadowColor: 'rgba(0,0,0,0.9)'
            }
        };
            // å¦‚æœæŒ‡å®šçš„é¢¨æ ¼ä¸å­˜åœ¨ï¼Œä½¿ç”¨ tech é¢¨æ ¼ä½œç‚ºé è¨­
        const currentStyle = styles[style] || styles.tech;
        
        // ç¹ªè£½æ¼¸å±¤èƒŒæ™¯
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, currentStyle.bg[0]);
        gradient.addColorStop(1, currentStyle.bg[1]);
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // åŠ ä¸ŠåŠé€æ˜çš„æš—è‰²è¦†è“‹å±¤ï¼Œå¢åŠ æ–‡å­—å¯è®€æ€§
        ctx.fillStyle = 'rgba(0,0,0,0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // è¨­å®šæ–‡å­—æ¨£å¼ä¸¦ç¹ªè£½ä¸»æ¨™é¡Œ
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = 'bold 48px "Microsoft JhengHei", sans-serif';
        ctx.fillStyle = currentStyle.textColor;
        ctx.shadowColor = currentStyle.shadowColor;
        ctx.shadowBlur = 10;
        ctx.fillText(text, canvas.width / 2, canvas.height / 2);
        
        // ç¹ªè£½è¡¨æƒ…ç¬¦è™Ÿåœ¨å·¦ä¸Šè§’
        ctx.font = '80px sans-serif';
        ctx.shadowBlur = 0;
        ctx.fillText(currentStyle.emoji, 60, 70);
    }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }        

    function initUI() {
        console.log("æ­£åœ¨åˆå§‹åŒ– UI å…ƒä»¶...");
        initTheme();   // åˆå§‹åŒ–ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        initSidebar(); // åˆå§‹åŒ–å´é‚Šæ¬„æ”¶åˆåŠŸèƒ½
        console.log("UI å…ƒä»¶åˆå§‹åŒ–å®Œæˆï¼");
    }
        
    function initTheme() {
        const themeToggle = document.getElementById('theme-toggle');
        const docEl = document.documentElement;
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                docEl.classList.add('dark');
            } else {
                docEl.classList.remove('dark');
            }
        };
            themeToggle.addEventListener('click', () => {
                const currentTheme = localStorage.getItem('theme') === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', currentTheme);
                applyTheme(currentTheme);
                console.log("ä¸»é¡Œå·²åˆ‡æ›ç‚º:", currentTheme);
            });
            // è¼‰å…¥ä¸¦å¥—ç”¨å„²å­˜çš„ä¸»é¡Œè¨­å®šï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨æ·ºè‰²ä¸»é¡Œ
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        console.log("å·²è¼‰å…¥ä¸»é¡Œè¨­å®š:", savedTheme);
        }
        
    function initSidebar(){
        const menuToggle = document.getElementById("menu-toggle");
        const mainContent = document.getElementById("main-content");
        const sidebar = document.getElementById("sidebar");
        
        // æ ¹æ“šè¢å¹•å¯¬åº¦æ±ºå®šåˆå§‹ç‹€æ…‹
        let isCollapsed = window.innerWidth < 1313;
        
        /**
         * @description å¥—ç”¨å´é‚Šæ¬„çš„æ”¶åˆç‹€æ…‹ã€‚
         * @param {boolean} collapsed - æ˜¯å¦æ”¶åˆ
         */
        const applySidebarState = (collapsed) => {
            if (collapsed) {
                sidebar.classList.add("collapsed");
                if (window.innerWidth >= 1313) {
                    mainContent.style.marginLeft = "72px"; // å¤§è¢å¹•æ™‚ä¿ç•™å°å´é‚Šæ¬„
                } else {
                    mainContent.style.marginLeft = "0"; // å°è¢å¹•æ™‚å®Œå…¨éš±è—
                }
            } else {
                sidebar.classList.remove("collapsed");
                mainContent.style.marginLeft = "240px"; // å®Œæ•´å´é‚Šæ¬„å¯¬åº¦
            }
        };
        
        // ç¶å®šé¸å–®åˆ‡æ›æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
        menuToggle.addEventListener("click", () => {
            isCollapsed = !isCollapsed;
            applySidebarState(isCollapsed);
            console.log("å´é‚Šæ¬„ç‹€æ…‹:", isCollapsed ? "æ”¶åˆ" : "å±•é–‹");
        });
        
        // ç›£è½è¦–çª—å¤§å°è®ŠåŒ–ï¼Œè‡ªå‹•èª¿æ•´å´é‚Šæ¬„
        window.addEventListener("resize", () => {
            const shouldCollapse = window.innerWidth < 1313;
            if (shouldCollapse !== isCollapsed) {
                isCollapsed = shouldCollapse;
                applySidebarState(isCollapsed);
                console.log("è¦–çª—å¤§å°è®ŠåŒ–ï¼Œå´é‚Šæ¬„è‡ªå‹•èª¿æ•´ç‚º:", isCollapsed ? "æ”¶åˆ" : "å±•é–‹");
            }
        });
        
        // å¥—ç”¨åˆå§‹ç‹€æ…‹
        applySidebarState(isCollapsed);
        console.log("å´é‚Šæ¬„åˆå§‹åŒ–å®Œæˆï¼Œç‹€æ…‹:", isCollapsed ? "æ”¶åˆ" : "å±•é–‹");
    }

    // ===================================================================================
    // ===                                ç¨‹å¼çµæŸ                                      ===
    // ===================================================================================
    // èªªæ˜ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½å·²ç¶“å®šç¾©å®Œæˆã€‚ç•¶ä½¿ç”¨è€…è¼‰å…¥é é¢æ™‚ï¼Œæœƒè‡ªå‹•åŸ·è¡Œ DOMContentLoaded äº‹ä»¶ï¼Œ
    //      é–‹å§‹æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„åˆå§‹åŒ–æµç¨‹ã€‚

    console.log("YouTube ä¼åŠƒæ¨¡æ“¬å™¨è…³æœ¬è¼‰å…¥å®Œæˆï¼");
    </script>
</body>
</html>